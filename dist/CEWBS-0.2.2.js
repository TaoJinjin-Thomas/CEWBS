!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){var meshers={greedy:require("./meshers/greedy_tri.js").mesher},CEWBS=window.CEWBS={};CEWBS.Util=require("./helpers/util.js"),CEWBS.version="0.2.2",CEWBS.VoxelMesh=function(name,scene){BABYLON.Mesh.call(this,name,scene)},CEWBS.VoxelMesh.prototype=Object.create(BABYLON.Mesh.prototype),CEWBS.VoxelMesh.prototype.constructor=CEWBS.VoxelMesh,CEWBS.VoxelMesh.prototype.mesher=meshers.greedy,CEWBS.VoxelMesh.prototype.coloringFunction=function(id){return[id/5,id/5,id/5]},CEWBS.VoxelMesh.prototype.setVoxelAt=function(x,y,z,metaData){return null==this.voxelData.voxels?"Error: please set the dimensions of the voxelData first!":void(Array.isArray(x)?this.voxelData.voxels[x[0]+x[1]*this.voxelData.dimensions[0]+x[2]*this.voxelData.dimensions[0]*this.voxelData.dimensions[1]]=y:this.voxelData.voxels[x+y*this.voxelData.dimensions[0]+z*this.voxelData.dimensions[0]*this.voxelData.dimensions[1]]=metaData)},CEWBS.VoxelMesh.prototype.setVoxelBatch=function(voxels,metaData){for(var i=0;i<voxels.length;i++){var voxel=voxels[i];voxel.length<4&&null!=metaData?this.setVoxelAt(voxel,metaData):this.setVoxelAt(voxel,voxel[3])}},CEWBS.VoxelMesh.prototype.getVoxelAt=function(x,y,z){return null!=this.voxelData.voxels?this.voxelData.voxels[x+y*this.voxelData.dimensions[0]+z*this.voxelData.dimensions[0]*this.voxelData.dimensions[1]]:"Error: please set the dimensions of the voxelData first!"},CEWBS.VoxelMesh.prototype.setVoxelData=function(voxelData){this.voxelData=voxelData},CEWBS.VoxelMesh.prototype.getVoxelData=function(){return this.voxelData},CEWBS.VoxelMesh.prototype.setDimensions=function(dims){return Array.isArray(dims)&&3==dims.length?(null==this.voxelData&&(this.voxelData={}),this.voxelData.dimensions=dims,null==this.voxelData.voxels&&(this.voxelData.voxels=new Array(dims[0]*dims[1]*dims[2])),void 0):"Error: dimensions must be an array [x,y,z]"},CEWBS.VoxelMesh.prototype.updateMesh=function(){var rawMesh=this.mesher(this.voxelData.voxels,this.voxelData.dimensions),positions=[],indices=[],colors=[],normals=[];rawMesh.vertices.length<1&&(this.isPickable=!1);for(var i=0;i<rawMesh.vertices.length;++i){var q=rawMesh.vertices[i];positions.push(q[0],q[1],q[2])}for(var i=0;i<rawMesh.faces.length;++i){var q=rawMesh.faces[i];indices.push(q[2],q[1],q[0]);for(var i2=0;3>i2;i2++){var color=this.coloringFunction(q[3]);null!=color?(colors[3*q[i2]]=color[0]/255,colors[3*q[i2]+1]=color[1]/255,colors[3*q[i2]+2]=color[2]/255):(colors[3*q[i2]]=1.5,colors[3*q[i2]+1]=.3,colors[3*q[i2]+2]=1.5)}}BABYLON.VertexData.ComputeNormals(positions,indices,normals);var vertexData=new BABYLON.VertexData;vertexData.positions=positions,vertexData.indices=indices,vertexData.normals=normals,vertexData.colors=colors,vertexData.applyToMesh(this,1),this._updateBoundingInfo()},CEWBS.VoxelMesh.prototype.originToCenterOfBounds=function(ignoreY){var pivotX=-this.voxelData.dimensions[0]/2,pivotY=-this.voxelData.dimensions[1]/2,pivotZ=-this.voxelData.dimensions[2]/2;ignoreY&&(pivotY=0),this.setPivot(pivotX,pivotY,pivotZ)},CEWBS.VoxelMesh.prototype.setPivot=function(pivotX,pivotY,pivotZ){var pivot=BABYLON.Matrix.Translation(pivotX,pivotY,pivotZ);this.setPivotMatrix(pivot)},CEWBS.VoxelMesh.prototype.exportVoxelData=function(){for(var convertedVoxels=[],i=0;i<this.voxelData.voxels.length;i++){var voxel=this.voxelData.voxels[i];if(null!=voxel){var x=i%this.voxelData.dimensions[0],y=Math.floor(i/this.voxelData.dimensions[0]%this.voxelData.dimensions[1]),z=Math.floor(i/(this.voxelData.dimensions[1]*this.voxelData.dimensions[0]));convertedVoxels.push([x,y,z,voxel])}}return{dimensions:this.voxelData.dimensions,voxels:convertedVoxels}},CEWBS.VoxelMesh.prototype.importZoxel=function(zoxelData){var cewbsData={};cewbsData.dimensions=[zoxelData.width,zoxelData.height,zoxelData.depth],cewbsData.voxels=zoxelData.frame1;for(var i=0;i<cewbsData.voxels.length;i++)cewbsData.voxels[i][3]=parseInt(cewbsData.voxels[i][3].toString(16).substring(0,6),16);this.setDimensions(cewbsData.dimensions),this.setVoxelBatch(cewbsData.voxels,16777215)},CEWBS.VoxelMesh.prototype.exportZoxel=function(){var cewbsData=this.exportVoxelData(),zoxelData={};zoxelData.creator="CEWBS Exporter",zoxelData.width=cewbsData.dimensions[0],zoxelData.height=cewbsData.dimensions[1],zoxelData.depth=cewbsData.dimensions[2],zoxelData.version=1,zoxelData.frames=1,zoxelData.frame1=cewbsData.voxels;for(var i=0;i<zoxelData.frame1.length;i++)zoxelData.frame1[i][3]=parseInt(CEWBS.Util.rgb2hex(this.coloringFunction(zoxelData.frame1[i][3]))+"FF",16);return zoxelData},CEWBS.VoxelMesh.handlePick=function(pickResult){var mesh=pickResult.pickedMesh,point=pickResult.pickedPoint,m=new BABYLON.Matrix;mesh.getWorldMatrix().invertToRef(m);var x,y,z,voxel1,voxel2,v=BABYLON.Vector3.TransformCoordinates(point,m),offsetX=+(v.x-v.x.toFixed(0)).toFixed(4),offsetY=+(v.y-v.y.toFixed(0)).toFixed(4),offsetZ=+(v.z-v.z.toFixed(0)).toFixed(4);return 0==offsetX?(x=Math.round(v.x),y=Math.floor(v.y),z=Math.floor(v.z),x>=mesh.voxelData.dimensions[0]&&(x=mesh.voxelData.dimensions[0]-1),voxel1=[x,y,z],voxel2=[x-1,y,z]):0==offsetY?(x=Math.floor(v.x),y=Math.round(v.y),z=Math.floor(v.z),y>=mesh.voxelData.dimensions[1]&&(y=mesh.voxelData.dimensions[1]-1),voxel1=[x,y,z],voxel2=[x,y-1,z]):0==offsetZ&&(x=Math.floor(v.x),y=Math.floor(v.y),z=Math.round(v.z),z>=mesh.voxelData.dimensions[2]&&(z=mesh.voxelData.dimensions[2]-1),voxel1=[x,y,z],voxel2=[x,y,z-1]),mesh.getVoxelAt(voxel1[0],voxel1[1],voxel1[2])?(pickResult.over=voxel2,pickResult.under=voxel1,pickResult):(pickResult.over=voxel1,pickResult.under=voxel2,pickResult)},window.CEWBS||(module.exports=CEWBS)},{"./helpers/util.js":2,"./meshers/greedy_tri.js":3}],2:[function(require,module){var util={};util.toHex=function(n){return n=parseInt(n,10),isNaN(n)?"00":(n=Math.max(0,Math.min(n,255)),"0123456789ABCDEF".charAt((n-n%16)/16)+"0123456789ABCDEF".charAt(n%16))},util.rgb2hex=function(rgb){return util.toHex(rgb[0])+util.toHex(rgb[1])+util.toHex(rgb[2])},util.hex2rgb=function(hexStr){return R=parseInt(hexStr.substring(0,2),16),G=parseInt(hexStr.substring(2,4),16),B=parseInt(hexStr.substring(4,6),16),[R,G,B]},module.exports=util},{}],3:[function(require,module,exports){function stringToChars(str){for(var num=0,i=0;i<str.length;i++)num+=str.charCodeAt(i);return num}var GreedyMesh=function(){var mask=new Int32Array(4096),origMask=new Array(4096);return function(volume,dims){function f(i,j,k){return volume[i+dims[0]*(j+dims[1]*k)]}for(var vertices=[],faces=[],d=0;3>d;++d){var i,j,k,l,w,h,u=(d+1)%3,v=(d+2)%3,x=[0,0,0],q=[0,0,0];for(mask.length<dims[u]*dims[v]&&(mask=new Int32Array(dims[u]*dims[v])),q[d]=1,x[d]=-1;x[d]<dims[d];){var n=0;for(x[v]=0;x[v]<dims[v];++x[v])for(x[u]=0;x[u]<dims[u];++x[u],++n){var a,b,origA,origB;a=origA=0<=x[d]?f(x[0],x[1],x[2]):0,b=origB=x[d]<dims[d]-1?f(x[0]+q[0],x[1]+q[1],x[2]+q[2]):0,"number"!=typeof a&&null!=a&&(a=stringToChars(JSON.stringify(a))),"number"!=typeof b&&null!=b&&(b=stringToChars(JSON.stringify(b))),!!origA==!!origB?(mask[n]=0,origMask[n]=0):origA?(mask[n]=a,origMask[n]=origA):(mask[n]=-b,origMask[n]=origB)}for(++x[d],n=0,j=0;j<dims[v];++j)for(i=0;i<dims[u];){var c=mask[n],origC=origMask[n];if(c){for(w=1;c===mask[n+w]&&i+w<dims[u];++w);var done=!1;for(h=1;j+h<dims[v];++h){for(k=0;w>k;++k)if(c!==mask[n+k+h*dims[u]]){done=!0;break}if(done)break}x[u]=i,x[v]=j;var du=[0,0,0],dv=[0,0,0];c>0?(dv[v]=h,du[u]=w):(c=-c,du[v]=h,dv[u]=w);var vertex_count=vertices.length;for(vertices.push([x[0],x[1],x[2]]),vertices.push([x[0]+du[0],x[1]+du[1],x[2]+du[2]]),vertices.push([x[0]+du[0]+dv[0],x[1]+du[1]+dv[1],x[2]+du[2]+dv[2]]),vertices.push([x[0]+dv[0],x[1]+dv[1],x[2]+dv[2]]),faces.push([vertex_count,vertex_count+1,vertex_count+2,origC]),faces.push([vertex_count,vertex_count+2,vertex_count+3,origC]),l=0;h>l;++l)for(k=0;w>k;++k)mask[n+k+l*dims[u]]=0;i+=w,n+=w}else++i,++n}}}return{vertices:vertices,faces:faces}}}();exports&&(exports.mesher=GreedyMesh)},{}]},{},[1]);